<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Result</title>

  <style>
    .image-grid {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 10px;
    }
    .image-grid .image-cell {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        border-bottom: 1px solid #000;
        cursor: pointer;
        transition: transform 0.2s;
    }
    .image-grid .image-cell:hover {
        transform: scale(1.05);
    }
    .image-grid .image-cell:nth-child(6n+1) img {
        border: 3px solid red;
    }
    .image-grid img {
        width: 100%;
        height: auto;
    }
    .image-label {
        margin-top: 5px;
        font-weight: bold;
        font-size: larger;
    }
    .page-title {
        text-align: center;
        padding: 20px;
    }
    .instructions {
        text-align: center;
        font-size: larger;
        color: #333;
    }
    .info {
        text-align: center;
        font-size: larger;
        color: #555;
        margin-top: 10px;
    }
    .sticky-btns {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        justify-content: center;
        margin-top: 20px;
    }
    .sticky-btn {
        padding: 20px 40px;
        background-color: #008CBA;
        color: white;
        font-size: 24px;
        border: none;
        cursor: pointer;
        border-radius: 20px;
        margin-right: 10px;
    }
    .sticky-btn:hover {
        background-color: #007B9A;
    }
  </style>
  <!-- Plotly.js -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>
  <h1>Result for models in {{mode}} dataset</h1>

  <!-- The graphs will be inserted inside these divs -->
  {% for graph in graphs %}
    <h2>Result for {{models[loop.index - 1]}} model</h2>
    {{ graph | safe }}
  {% endfor %}

  <div id="imageDisplay" style="padding: 20px; margin-top: 20px; text-align: center;">
    Click on a point to see the image.
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', (event) => {
        document.querySelectorAll('.plotly-graph-div').forEach((graphDiv) => {
            graphDiv.on('plotly_click', function(data) {
                var pts = data.points[0];
                var x = pts.x;
                var y = pts.y;
    
                fetch('/get_image', {
                    method: 'POST',
                    credentials: 'include',
                    body: JSON.stringify({x: x, y: y}),
                    headers: new Headers({
                        'Content-Type': 'application/json'
                    })
                })
                .then(response => response.json())
                .then(data => {
                    var imageDisplay = document.getElementById('imageDisplay');
                    if(data.exists) {
                        // Display the primary image with labels
                        var content = `
                            <img src="${data.imagePath}" alt="Image" style="max-width: 100%; height: auto;">
                            <div class="image-label">Name of file: ${data.name}</div>
                            <div class="image-label">Ground Truth: ${data.label}</div>
                            <div class="image-label">DenseNet Prediction: ${data.prediction}</div>
                            <div class="image-label">Expert: ${data.expert_label}</div>
                            <div class="image-label">Number of models that failed prediction: ${data.failed_models}</div>
                        `;
    
                        // Check if there are kNN images and add a label if so
                        if (data.knnImagePaths && data.knnImagePaths.length > 0) {
                            content += `<div class="image-label">5 Nearest Neighbors:</div>`; // Label for kNN images
                            
                            // Add kNN images
                            data.knnImagePaths.forEach((path, index) => {
                                content += `<img src="${path}" alt="kNN Image ${index + 1}" style="max-width: 100%; height: auto; margin: 5px;">`;
                            });
                        }
    
                        imageDisplay.innerHTML = content;
                    } else {
                        // Image does not exist, display message
                        var content = `
                            <div class="image-label">${data.message}</div>
                            <div class="image-label">Name of file: ${data.name}</div>
                            <div class="image-label">Ground Truth: ${data.label}</div>
                            <div class="image-label">DenseNet Prediction: ${data.prediction}</div>
                            <div class="image-label">Number of models that failed prediction: ${data.failed_models}</div>
                        `;
                        
                        imageDisplay.innerHTML = content;
                    }
                })
                .catch(error => console.error('Error:', error));
            });
        });
    });
    </script>
      
    
</body>
</html>
